<div class="space-y-4">
  <div class="flex items-center gap-3">
    <h2 class="text-sm font-semibold text-white">Withdraw</h2>
  </div>
  <div class="space-y-3">
    <app-search-select
      [options]="availableCurrencies"
      [placeholder]="'Search currency...'"
      (optionSelected)="onCurrencySelected($event)"
    />
  </div>
  <form [formGroup]="withdrawForm" class="space-y-4">
    <div class="p-4 bg-primary/10 rounded-xl border border-primary/10 space-y-4">
      <div>
          <label class="text-xs text-white/60 mb-2 block">Amount to withdraw</label>
          <div class="relative">
          <input
              type="text"
              formControlName="amount"
              (input)="onAmountInput($event)"
              [class.border-red-500]="withdrawForm.get('amount')?.invalid && withdrawForm.get('amount')?.touched"
              class="no-spinner flex w-full rounded-lg border-input bg-skin1 px-4 py-3 pr-20 text-white placeholder-white/40 border border-primary/40 focus:border-primary/20 outline-none transition-colors"
              placeholder="Enter amount to withdraw"
          />
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-sm font-medium text-white/40">{{ userCurrency() }}</span>
          </div>
          @if (convertedAmount()) {
            <div class="flex items-center justify-center gap-2 px-4 py-3 mt-3 bg-warning/5 rounded-lg border border-warning/20">
              <span class="text-sm font-light text-white/40">
                {{ convertedAmount()!.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 2}) }} {{ convertedAmount()!.fromCurrency }}
              </span>
              <app-icon name="arrow-right" class="w-4 h-4 text-warning"></app-icon>
              <span class="text-sm font-semibold text-warning">
                {{ convertedAmount()!.convertedValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) }} {{ convertedAmount()!.toCurrency }}
              </span>
            </div>
          }
          @if (formErrorMessage()) {
          <p class="text-xs text-danger mt-2">{{ formErrorMessage() }}</p>
          } @else {
          <p class="text-xs text-white/40 mt-2">Min: {{ minWithdrawAmount() }} {{ currency() }} | Max: {{ maxWithdrawAmount() }} {{ currency() }}</p>
          }
      </div>
      <div>
          <label class="text-xs text-white/60 mb-2 block">Wallet Address (TRC20)</label>
          <div class="relative">
          <input
              type="text"
              formControlName="walletAddress"
              [class.border-red-500]="withdrawForm.get('walletAddress')?.invalid && withdrawForm.get('walletAddress')?.touched"
              class="no-spinner flex w-full rounded-lg border-input bg-skin1 px-4 py-3 pr-20 text-white placeholder-white/40 border border-primary/40 focus:border-primary/20 outline-none transition-colors"
              placeholder="Enter your {{ currency() }} wallet address"
          />
          </div>
          @if (withdrawForm.get('walletAddress')?.invalid && withdrawForm.get('walletAddress')?.touched) {
            <p class="text-xs text-danger mt-2">Wallet address is required</p>
          }
      </div>
    </div>
    
    <div class="p-4 bg-primary/10 rounded-xl border border-primary/10 space-y-4">
      @if (showSuccess()) {
        <div class="flex items-start gap-3 p-4 bg-success/5 rounded-xl border border-success/10">
          <div class="flex-shrink-0 w-6 h-6 rounded-full border border-success flex items-center justify-center mt-0.5">
            <app-icon name="success" class="w-4 h-4 text-success"></app-icon>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-success mb-1">Withdrawal completed successfully</p>
            <p class="text-xs text-white/60">Transaction has been sent to your wallet.</p>
          </div>
        </div>
      }
      @if (showError()) {
        <div class="flex items-start gap-3 p-4 bg-danger/5 rounded-xl border border-danger/10">
          <div class="flex-shrink-0 w-6 h-6 rounded-full border border-danger flex items-center justify-center mt-0.5">
            <app-icon name="faild" class="w-4 h-4 text-danger"></app-icon>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-danger mb-1">Withdrawal was not completed</p>
            <p class="text-xs text-white/60">No funds were withdrawn.</p>
          </div>
        </div>
      }
      <div class="w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br from-warning/20 to-warning/10 flex items-center justify-center">
        <app-icon name="wallet-base" class="w-7 h-7 text-warning"></app-icon>
      </div>
      <div class="text-center">
        <p class="text-sm font-medium text-foreground mb-1">Withdraw {{currency()}}</p>
        <p class="text-xs text-white/40">Enter amount and wallet address to withdraw</p>
      </div>
      <button
        type="button"
        (click)="onWithdraw()"
        [disabled]="isButtonDisabled"
        class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary hover:bg-primary/90 px-4 py-2 w-full bg-gradient-to-r from-warning to-warning/80 hover:from-warning/90 hover:to-warning/70 text-warning-foreground font-semibold rounded-xl h-12 cursor-pointer"
      >
        Withdraw
      </button>
    </div>
  </form>
</div>
