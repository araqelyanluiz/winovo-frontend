<div class="space-y-4">
  <div class="flex items-center gap-3">
    <h2 class="text-sm font-semibold text-white">Deposit</h2>
  </div>
  
  <div class="space-y-3">
    <app-search-select
      [options]="availableCurrencies"
      [placeholder]="'Search currency...'"
      (optionSelected)="onCurrencySelected($event)"
    />
  </div>
  <form [formGroup]="depositForm" class="space-y-4">
    <div class="p-4 bg-primary/10 rounded-xl border border-primary/10 space-y-4">
      <label class="text-xs text-white/60 mb-2 block">Amount to deposit</label>
      <div class="relative">
        <input
          type="text"
          formControlName="amount"
          (input)="onAmountInput($event)"
          [class.border-red-500]="depositForm.get('amount')?.invalid && depositForm.get('amount')?.touched"
          class="no-spinner flex w-full rounded-lg border-input bg-skin1 px-4 py-3 pr-20 text-white placeholder-white/40 border border-primary/40 focus:border-primary/20 outline-none transition-colors"
          placeholder="Enter amount to deposit"
        />
        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-sm font-medium text-white/40">{{userCurrency()}}</span>
      </div>
      @if (convertedAmount()) {
        <div class="flex items-center justify-center gap-2 px-4 py-3 bg-success/5 rounded-lg border border-success/20">
          <span class="text-sm font-light text-white/40">
            {{ convertedAmount()!.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 2}) }} {{ convertedAmount()!.fromCurrency }}
          </span>
          <app-icon name="arrow-right" class="w-4 h-4 text-success"></app-icon>
          <span class="text-sm font-semibold text-success">
            {{ convertedAmount()!.convertedValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) }} {{ convertedAmount()!.toCurrency }}
          </span>
        </div>
      }
      @if (formErrorMessage()) {
        <p class="text-xs text-danger mt-2">{{ formErrorMessage() }}</p>
      } @else {
        <p class="text-xs text-white/40 mt-2">
          Min deposit: {{ minDepositAmount }} {{ userCurrency() }}
        </p>
      }
    </div>
    <div class="p-4 bg-primary/10 rounded-xl border border-primary/10 space-y-4">
      @if (showSuccess() && depositAddress()) {
        <div class="flex items-start gap-3 p-4 bg-success/5 rounded-xl border border-success/10">
          <div class="flex-shrink-0 w-6 h-6 rounded-full border border-success flex items-center justify-center mt-0.5">
            <app-icon name="success" class="w-4 h-4 text-success"></app-icon>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-success mb-1">Deposit address generated successfully</p>
            <p class="text-xs text-white/60">Send funds to the address below.</p>
          </div>
        </div>

        <div class="flex items-start gap-3 p-4 bg-warning/5 rounded-xl border border-warning/10">
          <app-icon name="warning" class="w-4 h-4 text-warning"></app-icon>
          <div class="flex-1">
            <p class="text-sm font-semibold text-warning mb-1">Important: Check Network!</p>
            @if (selectedCurrency()?.networks && selectedCurrency()!.networks!.length > 0) {
              <p class="text-xs text-white/60">
                Only send <span class="font-semibold text-white">{{ selectedCurrency()?.value }}</span> via 
                <span class="font-semibold text-warning">{{ selectedCurrency()!.networks!.join(', ') }}</span> 
                network(s).
              </p>
              <span class="text-xs font-light text-white/40">Sending via wrong network will result in permanent loss of funds.</span>
            } @else {
              <p class="text-xs text-white/60">
                Send  onley <span class="font-semibold text-white">{{ selectedCurrency()?.value }}</span> to this address. 
                Sending other currencies will result in permanent loss of funds.
              </p>
            }
          </div>
        </div>
        
        <div class="space-y-2">
          <label class="text-xs text-white/60 block">Deposit Address</label>
          <div class="flex gap-2 relative">
            <input
              type="text"
              [value]="depositAddress()"
              readonly
              class="flex-1 rounded-lg border-input bg-skin1 px-4 py-3 text-white border border-primary/40 outline-none"
            />
            <div class="relative">
              <button
                type="button"
                (click)="onCopyAddress()"
                class="flex-shrink-0 w-12 h-12 bg-primary/10 hover:bg-primary/20 rounded-full border border-primary/40 transition-colors cursor-pointer flex items-center justify-center"
              >
                <app-icon name="copy" class="w-4 h-4 text-primary"></app-icon>
              </button>
              @if (showCopiedTooltip()) {
                <div class="absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-1.5 bg-skin1 text-white text-xs font-medium rounded-lg whitespace-nowrap shadow-lg">
                  Copied!
                  <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-skin1 rotate-45"></div>
                </div>
              }
            </div>
          </div>
        </div>
        
        <button
          type="button"
          (click)="onGenerateNewAddress()"
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm px-4 py-2 w-full bg-primary/90 hover:bg-primary/70 text-white font-semibold rounded-xl h-12 cursor-pointer transition-colors border border-primary/40"
        >
          Generate New Address
        </button>
      } @else if (showError()) {
        <div class="flex items-start gap-3 p-4 bg-danger/5 rounded-xl border border-danger/10">
          <div class="flex-shrink-0 w-6 h-6 rounded-full border border-danger flex items-center justify-center mt-0.5">
            <app-icon name="faild" class="w-4 h-4 text-danger"></app-icon>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-danger mb-1">Failed to generate deposit address</p>
            <p class="text-xs text-white/60">Please try again.</p>
          </div>
        </div>
        
        <button
          type="button"
          (click)="onTryAgain()"
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm px-4 py-2 w-full bg-danger/20 hover:bg-danger/30 text-white font-semibold rounded-xl h-12 cursor-pointer transition-colors border border-danger/40"
        >
          Try Again
        </button>
      } @else {
        <div
          class="w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br from-success/20 to-success/10 flex items-center justify-center"
        >
          <app-icon name="wallet-base" class="w-7 h-7 text-success"></app-icon>
        </div>
        <div class="text-center">
          <p class="text-sm font-medium text-foreground mb-1">Generate Deposit Address</p>
          <p class="text-xs text-white/40">
            Click below to generate a unique address for your {{selectedCurrency()?.value}} deposit
          </p>
        </div>
        <button 
          type="button"
          (click)="onGenerateAddress()"
          [disabled]="isButtonDisabled || isLoading()" 
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary hover:bg-primary/90 px-4 py-2 w-full bg-gradient-to-r from-success to-success/80 hover:from-success/90 hover:to-success/70 text-success-foreground font-semibold rounded-xl h-12 cursor-pointer"
        >
          @if (isLoading()) {
            <span>Loading...</span>
          } @else {
            <span>Create Deposit</span>
          }
        </button>
      }
    </div>
  </form>
</div>
